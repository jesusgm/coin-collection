---
import Layout from "../layouts/index.astro";

import coins from "../data/coins.json";
import countries from "../data/countries.json";
import years from "../data/years.json";
import YearsFilters from "../components/filters/YearsFilters.astro";
import CountryFilters from "../components/filters/CountryFilters.astro";
import CoinList from "../components/CoinList.astro";

export async function getStaticPaths() {
  return {
    props: { coins, countries, years },
  };
}

const coinContainerId = "coin-container";
---

<Layout>
  <YearsFilters years={years} />
  <CountryFilters countries={countries} />

  <CoinList coinContainerId={coinContainerId} coins={coins} />
</Layout>

<script define:vars={{ coinContainerId }}>
  const filters = Object.fromEntries(
    new URLSearchParams(window.location.search)
  );

  const coinContainer = document.getElementById(coinContainerId);

  coinContainer.querySelectorAll("li").forEach((coinContainer) => {
    const year = coinContainer.dataset.year;
    const country = coinContainer.dataset.country;

    if (filters.year && !filters.year.includes(year)) {
      coinContainer.style.display = "none";
    }

    if (filters.country && !filters.country.includes(country)) {
      coinContainer.style.display = "none";
    }
  });
</script>
